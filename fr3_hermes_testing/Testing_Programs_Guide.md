# FR3双臂机器人测试程序详细指南

## 概述

本文档详细描述了FR3双臂机器人系统的全套测试程序，包括每个测试的目标、内容、执行方法和预期结果。所有测试程序基于安全第一的原则设计，支持交互式操作和实时安全监控。

## 测试程序架构

```
FR3测试体系
├── 单臂测试 (SAT系列)
│   ├── SAT001.py - 连接测试
│   ├── SAT002.py - 基础运动测试
│   ├── SAT003.py - 笛卡尔空间运动测试
│   └── SAT004.py - 工作空间测试
├── 双臂协调测试 (DAT系列)
│   ├── DAT001.py - 同步连接测试
│   └── DAT002.py - 安全距离测试
└── 安全模型
    └── dual_arm_safety_model.py - 双臂安全避障模型
```

---

## 单臂测试系列 (SAT)

### SAT001.py - 单臂连接测试

#### 测试目标
验证与FR3机械臂的网络连接和SDK通信功能，确保机器人控制系统的基础通信能力。

#### 测试内容
1. **基础连接测试**
   - 网络连接建立
   - 连接时间测量
   - 连接稳定性验证

2. **SDK信息获取**
   - SDK版本查询
   - 控制器IP验证
   - 系统信息读取

3. **机器人状态测试**
   - 机器人运行状态
   - 机器人模式检查
   - 故障码读取
   - 运动完成状态

4. **关节位置获取**
   - 实时关节角度读取
   - 关节速度获取
   - 数据精度验证

5. **TCP位置获取**
   - 工具坐标系位姿
   - 位置和姿态数据
   - 坐标系一致性

6. **IO状态测试**
   - 数字输入状态
   - 数字输出状态
   - IO通信测试

#### 执行方法
```bash
python SAT001.py --arm right --ip 192.168.58.2
python SAT001.py --arm left --ip 192.168.58.3
```

#### 预期结果
- **连接成功**：延迟 < 50ms
- **SDK版本匹配**：版本信息正确显示
- **状态信息完整**：所有状态数据正常读取
- **无故障码**：主故障码和子故障码均为0
- **数据精度**：位置数据精度在合理范围内

#### 可能的问题及解决方案
| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 连接超时 | 网络配置问题 | 检查IP地址和网络连接 |
| SDK版本不匹配 | 库版本问题 | 更新fairino库 |
| 故障码非零 | 机器人状态异常 | 检查机器人物理状态 |

---

### SAT002.py - 单臂基础运动测试

#### 测试目标
验证单轴运动控制、关节限位保护和基础运动功能，确保机械臂的基本运动能力。

#### 测试内容
1. **连接和使能**
   - 机器人连接建立
   - 自动模式设置
   - 机器人使能

2. **初始位置记录**
   - 关节角度记录
   - TCP位姿记录
   - 基准位置建立

3. **关节运动测试**
   - 基于当前位姿的安全运动设计
   - 小幅度关节运动（±2°）
   - 运动平滑性检查
   - 到位精度验证

4. **TCP运动测试**
   - 直线运动控制
   - 基于类人型双臂配置的安全路径
   - 运动精度测量

5. **紧急停止测试**
   - 运动中急停功能
   - 停止响应时间
   - 安全停止验证

6. **返回初始位置**
   - 归位精度测试
   - 重复定位能力

#### 执行方法
```bash
python SAT002.py --arm right --ip 192.168.58.2
python SAT002.py --arm left --ip 192.168.58.3
```

#### 预期结果
- **运动平滑性**：各关节运动无抖动
- **限位保护有效**：关节限位自动保护
- **实际角度误差 < 0.1°**：高精度运动控制
- **轨迹跟踪误差 < 2mm**：TCP运动精度
- **急停响应 < 100ms**：快速安全响应

#### 安全特性
- 运动幅度限制（关节±2°，TCP±15mm）
- 基于类人型配置的安全区域检查
- 双臂间安全距离验证
- 实时速度限制（20%额定速度）

---

### SAT003.py - 笛卡尔空间运动测试

#### 测试目标
验证直线运动和圆弧运动控制，测试笛卡尔空间的运动精度和轨迹跟踪能力。

#### 测试内容
1. **交互式运动输入**
   - 相对位置运动（输入XYZ偏移量）
   - 绝对位置运动（输入目标坐标）
   - 圆弧运动测试（预设安全圆弧）
   - 实时安全范围提示

2. **直线运动测试 (MoveL)**
   - 用户自定义目标位置
   - 实时安全检查
   - 运动轨迹验证
   - 到位精度测量

3. **圆弧运动测试 (MoveC)**
   - 预设安全圆弧路径
   - 三点圆弧运动
   - 圆弧精度验证
   - 自动返回起点

4. **速度控制测试**
   - 多种速度下的精度测试
   - 速度与精度关系分析
   - 运动时间统计

5. **奇异点回避**
   - 奇异配置检测
   - 自动路径规划
   - 奇异点处理

#### 执行方法
```bash
python SAT003.py --arm right --ip 192.168.58.2
python SAT003.py --arm left --ip 192.168.58.3
```

#### 交互示例
```
选择运动类型:
1. 相对位置运动 (输入相对偏移量)
2. 绝对位置运动 (输入目标坐标)  
3. 圆弧运动测试 (预设安全圆弧)
4. 退出测试

请选择 (1-4): 1

输入相对位置偏移 (mm):
  X轴偏移 (建议范围 ±100): 50
  Y轴偏移 (建议范围 ±100): 30
  Z轴偏移 (建议范围 ±100): 20
```

#### 预期结果
- **轨迹跟踪误差 < 2mm**：直线运动精度
- **圆弧精度 < 3mm**：圆弧运动精度
- **速度控制准确**：多速度下一致性能
- **奇异点自动回避**：无奇异点卡死

#### 安全限制
- 最大单次移动距离：100mm
- 圆弧半径：30mm
- 工作空间边界检查
- 双臂安全距离验证

---

### SAT004.py - 工作空间测试

#### 测试目标
验证机械臂可达工作空间，生成工作空间云图，标记奇异区域。

#### 测试内容
1. **边界点可达性测试**
   - 最大臂展边界点（8个方向采样）
   - 不同高度的边界点
   - 最小工作半径测试点
   - 预期不可达点验证

2. **工作空间云图生成**
   - 规则网格采样（10×10×6）
   - 逆运动学可达性检查
   - 安全区域约束应用
   - 工作空间覆盖率统计

3. **奇异配置测试**
   - 肩部奇异点（J1轴线与末端重合）
   - 肘部奇异点（J3 = 0°或180°）
   - 腕部奇异点（J5 = 0°）
   - 奇异配置识别和记录

4. **逆运动学验证**
   - 目标位置逆解测试
   - 解的存在性验证
   - 多解情况处理
   - 解的精度检查

#### 执行方法
```bash
python SAT004.py --arm right --ip 192.168.58.2
python SAT004.py --arm left --ip 192.168.58.3
```

#### 预期结果
- **工作空间符合规格**：最大半径 ≈ 630mm
- **边界点可达**：边界测试准确率 > 80%
- **云图数据完整**：生成完整的可达性数据
- **奇异区域明确标识**：奇异点正确识别
- **逆运动学误差 < 1mm**：高精度求解

#### 输出文件
- `logs/SAT004_[arm]_report_[timestamp].json` - 测试报告
- `logs/SAT004_[arm]_workspace_[timestamp].csv` - 工作空间数据

#### CSV数据格式
```csv
X,Y,Z,Reachable
-400.0,-600.0,-400.0,0
-400.0,-600.0,-240.0,1
...
```

---

## 双臂协调测试系列 (DAT)

### DAT001.py - 双臂同步连接测试

#### 测试目标
验证双臂同时连接和控制，确保双臂系统的协调工作能力。

#### 测试内容
1. **并行连接测试**
   - 使用多线程同时连接双臂
   - 连接时间测量
   - 连接成功率统计
   - 连接稳定性验证

2. **独立控制测试**
   - 双臂模式独立设置
   - 双臂使能独立控制
   - 状态独立获取
   - 控制互不干扰验证

3. **同步状态获取**
   - 双臂状态同时读取
   - 状态更新频率测试
   - 同步性能分析
   - 数据一致性检查

4. **双臂安全距离**
   - 实时末端距离计算
   - 安全模型碰撞检测
   - 工作空间分离验证
   - 安全阈值检查

5. **通信干扰测试**
   - 并发通信测试
   - 通信性能分析
   - 干扰检测
   - 数据传输稳定性

#### 执行方法
```bash
python DAT001.py --left-ip 192.168.58.3 --right-ip 192.168.58.2
```

#### 预期结果
- **双臂同时在线**：并行连接成功
- **控制互不干扰**：独立控制正常
- **状态同步更新**：更新频率 > 50Hz
- **安全距离保持**：末端距离 > 300mm
- **通信性能良好**：无明显干扰

#### 性能指标
- 连接时间：< 3秒
- 状态同步频率：> 100Hz
- 通信延迟：< 10ms
- 安全距离：> 300mm

---

### DAT002.py - 双臂安全距离测试

#### 测试目标
验证双臂防碰撞功能，测试安全距离保持和碰撞响应能力。

#### 测试内容
1. **静态安全距离测试**
   - 多种距离阈值测试（500-150mm）
   - 当前双臂距离测量
   - 安全模型碰撞检测
   - 静态安全状态评估

2. **动态接近测试**
   - 设计安全的接近运动
   - 实时安全监控
   - 自动紧急停止
   - 接近过程数据记录

3. **碰撞响应时间测试**
   - 检测响应时间测量
   - 停止指令响应时间
   - 总响应时间分析
   - 响应时间要求验证

4. **不同姿态安全测试**
   - 上举姿态安全性
   - 前伸姿态安全性
   - 侧展姿态安全性
   - 多姿态安全距离验证

5. **安全监控系统**
   - 实时监控线程
   - 20Hz监控频率
   - 自动安全停止
   - 安全状态日志

#### 执行方法
```bash
python DAT002.py --left-ip 192.168.58.3 --right-ip 192.168.58.2
```

#### 预期结果
- **安全距离保持 > 300mm**：静态安全验证
- **自动停止响应 < 100ms**：快速响应能力
- **距离计算准确**：实时精确测量
- **多姿态安全率 > 80%**：各种姿态安全
- **监控系统稳定**：持续可靠监控

#### 安全机制
- 300mm安全距离阈值
- 100ms响应时间要求
- 实时监控（20Hz）
- 自动紧急停止
- 多级安全检查

---

## 安全模型

### dual_arm_safety_model.py - 双臂安全避障模型

#### 功能概述
提供完整的双臂机器人安全保障机制，包括运动学计算、碰撞检测和路径规划。

#### 核心功能
1. **运动学计算**
   - 正向运动学（DH参数法）
   - 逆向运动学（数值求解）
   - 雅可比矩阵计算

2. **碰撞检测**
   - 单臂自碰撞检测
   - 双臂互碰撞检测
   - 简化几何模型
   - 安全裕度设置

3. **工作空间验证**
   - 安全区域定义
   - 边界检查
   - 工作空间分离

4. **路径规划**
   - 无碰撞路径生成
   - 线性插值规划
   - 安全路径验证

#### 配置参数
- 基座间距：400mm
- 安全裕度：50mm
- 连杆半径：40mm（简化）
- 最大臂展：630mm

---

## 测试执行指南

### 环境准备
```bash
# 1. 激活虚拟环境
source venv/bin/activate

# 2. 检查网络连接
ping 192.168.58.2  # 右臂
ping 192.168.58.3  # 左臂

# 3. 创建日志目录
mkdir -p logs

# 4. 检查Python依赖
python -c "import fairino, numpy; print('Dependencies OK')"
```

### 安全检查清单
- [ ] 急停按钮就位
- [ ] 安全区域清空
- [ ] 测试人员到位
- [ ] 机械臂状态正常
- [ ] 网络连接稳定

### 测试执行顺序
1. **基础测试**：SAT001 → SAT002
2. **单臂功能**：SAT003 → SAT004
3. **双臂协调**：DAT001 → DAT002

### 测试报告
每个测试程序会生成：
- **详细日志**：`logs/[TEST_ID]_[arm]_[timestamp].log`
- **JSON报告**：`logs/[TEST_ID]_[arm]_report_[timestamp].json`
- **数据文件**：CSV格式（部分测试）

### 测试结果评估

#### 通过标准
| 测试项目 | 通过标准 |
|----------|----------|
| 连接测试 | 延迟 < 50ms，无错误 |
| 运动测试 | 精度 < 2mm，平滑运行 |
| 工作空间 | 覆盖率符合规格 |
| 双臂协调 | 同步性能良好 |
| 安全距离 | 保持 > 300mm |

#### 失败处理
1. **记录问题现象**
2. **保存测试数据**
3. **分析失败原因**
4. **制定解决方案**
5. **重新测试验证**

---

## 常见问题与解决方案

### 连接问题
**问题**：无法连接机器人
**解决方案**：
1. 检查IP地址配置
2. 验证网络连通性
3. 确认机器人上电状态
4. 检查防火墙设置

### 运动异常
**问题**：运动精度不足
**解决方案**：
1. 检查机器人标定状态
2. 验证负载配置
3. 调整运动速度
4. 检查机械磨损

### 安全告警
**问题**：频繁安全停止
**解决方案**：
1. 调整安全参数
2. 检查碰撞检测灵敏度
3. 验证工作空间设置
4. 优化运动轨迹

### 性能问题
**问题**：响应时间过长
**解决方案**：
1. 优化网络配置
2. 减少并发操作
3. 调整监控频率
4. 检查系统负载

---

## 扩展与定制

### 添加新测试
1. 继承基础测试框架
2. 实现特定测试逻辑
3. 集成安全检查
4. 添加日志和报告

### 参数调整
- 修改安全距离阈值
- 调整运动速度限制
- 设置工作空间边界
- 配置响应时间要求

### 集成其他设备
- 添加传感器数据
- 集成视觉系统
- 连接外部设备
- 扩展IO功能

---

**文档版本**: v1.0  
**创建日期**: 2025-07-15  
**维护人**: kevin 
**状态**: 完整版本