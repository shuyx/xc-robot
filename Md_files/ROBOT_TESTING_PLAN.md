# XC-ROBOT 机器人系统综合测试规划

## 项目概述

### 测试目标
构建全面、系统化的测试框架，确保XC-ROBOT双臂移动机器人系统的安全性、可靠性和性能表现。测试覆盖FR3双机械臂、Hermes底盘及其协调控制的各个方面。

### 测试原则
1. **安全第一**: 所有测试必须在确保人员和设备安全的前提下进行
2. **渐进式测试**: 从基础功能到复杂场景，逐步推进
3. **可中断性**: 所有运动测试必须支持紧急停止和远程中断
4. **可追溯性**: 记录详细的测试日志和结果数据
5. **可重复性**: 测试过程标准化，确保结果可重现

### 硬件配置
- **左臂FR3**: IP地址 192.168.58.3
- **右臂FR3**: IP地址 192.168.58.2  
- **Hermes底盘**: IP地址 192.168.31.211:1448
- **基座间距**: 380mm (胸部宽度)
- **单臂最大臂展**: 620mm

## 测试架构

### 1. 测试层级

```
Level 1: 组件级测试 (Component Tests)
├── 单臂测试 (Single Arm)
├── 底盘测试 (Chassis)
└── 仿真测试 (Simulation)

Level 2: 集成测试 (Integration Tests)
├── 双臂协调测试 (Dual Arms Coordination)
├── 底盘-机械臂联动 (Chassis-Arm Integration)
└── 系统通信测试 (System Communication)

Level 3: 场景测试 (Scenario Tests)
├── 任务场景测试 (Task Scenarios)
├── 异常处理测试 (Exception Handling)
└── 性能压力测试 (Performance Tests)

Level 4: 验收测试 (Acceptance Tests)
├── 功能验收 (Functional Acceptance)
├── 性能验收 (Performance Acceptance)
└── 安全验收 (Safety Acceptance)
```

### 2. 测试环境配置

#### 2.1 安全配置
```yaml
safety_config:
  # 紧急停止
  emergency_stop:
    enable: true
    hotkey: "Space"
    remote_trigger: true
    
  # 运动限制
  motion_limits:
    max_joint_velocity: 30  # 度/秒
    max_tcp_velocity: 100   # mm/秒
    safe_distance: 50       # mm (双臂最小间距)
    
  # 碰撞检测
  collision_detection:
    enable: true
    force_threshold: 10     # N
    response_time: 50       # ms
```

#### 2.2 测试工具配置
```yaml
test_tools:
  # 数据记录
  data_logging:
    format: "JSON"
    frequency: 100  # Hz
    fields: ["timestamp", "joint_positions", "tcp_positions", "forces", "errors"]
    
  # 远程监控
  remote_monitoring:
    enable: true
    dashboard_port: 8080
    api_port: 8081
    
  # 测试控制
  test_control:
    interactive_mode: true
    batch_mode: true
    pause_between_tests: 2  # 秒
```

## 详细测试计划

### Level 1: 组件级测试

#### 1.1 单臂测试 (Single Arm Tests)

##### 1.1.1 连接性测试
**测试ID**: SAT-001  
**测试目的**: 验证与FR3机械臂的网络连接和SDK通信  
**测试步骤**:
1. 启动测试脚本 `fr3_hermes_testing/single_arm_connection_test.py`
2. 输入目标机械臂IP地址
3. 验证连接状态和SDK版本
4. 检查机器人状态反馈

**预期结果**:
- 连接成功，延迟 < 50ms
- SDK版本匹配
- 状态信息完整

##### 1.1.2 基础运动测试
**测试ID**: SAT-002  
**测试目的**: 验证单轴运动控制和关节限位  
**测试步骤**:
1. 使能机器人
2. 逐个测试6个关节的正反向运动
3. 测试关节限位保护
4. 验证运动平滑性

**预期结果**:
- 各关节运动平滑，无抖动
- 限位保护有效
- 实际角度与指令误差 < 0.1°

##### 1.1.3 笛卡尔空间运动测试
**测试ID**: SAT-003  
**测试目的**: 验证直线运动和圆弧运动控制  
**测试步骤**:
1. 执行MoveL直线运动测试
2. 执行MoveC圆弧运动测试
3. 测试不同速度下的轨迹精度
4. 验证奇异点回避

**预期结果**:
- 轨迹跟踪误差 < 2mm
- 速度控制准确
- 奇异点自动回避

##### 1.1.4 工作空间测试
**测试ID**: SAT-004  
**测试目的**: 验证机械臂可达工作空间  
**测试步骤**:
1. 定义工作空间边界点
2. 测试边界可达性
3. 生成工作空间云图
4. 标记奇异区域

**预期结果**:
- 工作空间符合规格
- 边界点可达
- 奇异区域明确标识

#### 1.2 底盘测试 (Chassis Tests)

##### 1.2.1 底盘连接测试
**测试ID**: CHT-001  
**测试目的**: 验证Hermes底盘HTTP API连接  
**测试步骤**:
1. 运行 `fr3_hermes_testing/chassis_connection_test.py`
2. 检查API端点响应
3. 获取底盘状态信息
4. 验证控制权限

**预期结果**:
- API响应时间 < 100ms
- 状态信息完整
- 控制权限正常

##### 1.2.2 基础移动测试
**测试ID**: CHT-002  
**测试目的**: 验证底盘基本移动功能  
**测试步骤**:
1. 测试8方向移动
2. 测试旋转控制
3. 测试速度调节
4. 验证制动功能

**预期结果**:
- 移动方向准确
- 速度控制线性
- 制动响应 < 0.5秒

##### 1.2.3 定位导航测试
**测试ID**: CHT-003  
**测试目的**: 验证底盘定位和导航功能  
**测试步骤**:
1. 获取当前位置
2. 设置目标坐标点
3. 执行自主导航
4. 验证到达精度

**预期结果**:
- 定位精度 < 10mm
- 导航路径合理
- 避障功能正常

#### 1.3 仿真测试 (Simulation Tests)

##### 1.3.1 运动学仿真测试
**测试ID**: SIM-001  
**测试目的**: 验证仿真系统运动学计算  
**测试步骤**:
1. 启动RobotSim仿真界面
2. 输入关节角度，验证正运动学
3. 输入目标位姿，验证逆运动学
4. 对比仿真与实机结果

**预期结果**:
- 运动学计算误差 < 1mm
- 仿真与实机一致
- 计算时间 < 10ms

##### 1.3.2 轨迹仿真测试
**测试ID**: SIM-002  
**测试目的**: 验证轨迹规划和仿真  
**测试步骤**:
1. 导入测试轨迹
2. 仿真轨迹执行
3. 检查碰撞检测
4. 导出仿真结果

**预期结果**:
- 轨迹平滑连续
- 碰撞检测有效
- 仿真帧率 > 30fps

### Level 2: 集成测试

#### 2.1 双臂协调测试

##### 2.1.1 双臂同步连接测试
**测试ID**: DAT-001  
**测试目的**: 验证双臂同时连接和控制  
**测试步骤**:
1. 运行 `fr3_hermes_testing/dual_arm_sync_test.py`
2. 同时连接左右臂
3. 验证独立控制
4. 测试同步状态获取

**预期结果**:
- 双臂同时在线
- 控制互不干扰
- 状态同步更新

##### 2.1.2 双臂安全距离测试
**测试ID**: DAT-002  
**测试目的**: 验证双臂防碰撞功能  
**测试步骤**:
1. 设置安全距离阈值
2. 控制双臂相向运动
3. 验证安全停止
4. 测试不同姿态下的距离计算

**预期结果**:
- 安全距离保持 > 50mm
- 自动停止响应 < 100ms
- 距离计算准确

##### 2.1.3 双臂协调动作测试
**测试ID**: DAT-003  
**测试目的**: 验证双臂协调任务执行  
**测试步骤**:
1. 执行对称动作（镜像）
2. 执行互补动作（递接物体）
3. 执行协同动作（共同搬运）
4. 验证时序同步

**预期结果**:
- 动作同步误差 < 50ms
- 相对位置精度 < 5mm
- 无碰撞发生

##### 2.1.4 双臂标定测试
**测试ID**: DAT-004  
**测试目的**: 验证双臂坐标系标定  
**测试步骤**:
1. 执行自动标定程序
2. 验证标定精度
3. 测试不同姿态下的坐标转换
4. 保存标定数据

**预期结果**:
- 标定误差 < 2mm
- 坐标转换准确
- 标定数据可复用

#### 2.2 底盘-机械臂联动测试

##### 2.2.1 移动中静态保持测试
**测试ID**: CAI-001  
**测试目的**: 验证底盘移动时机械臂姿态保持  
**测试步骤**:
1. 设置机械臂固定姿态
2. 控制底盘移动
3. 监测末端位置变化
4. 验证补偿算法

**预期结果**:
- 末端位置偏差 < 10mm
- 姿态保持稳定
- 无振动累积

##### 2.2.2 协调运动测试
**测试ID**: CAI-002  
**测试目的**: 验证底盘和机械臂协调运动  
**测试步骤**:
1. 规划联合运动轨迹
2. 同步执行运动
3. 验证时序协调
4. 测试不同速度组合

**预期结果**:
- 运动同步性好
- 轨迹跟踪准确
- 速度匹配合理

##### 2.2.3 动态工作空间测试
**测试ID**: CAI-003  
**测试目的**: 验证移动扩展工作空间  
**测试步骤**:
1. 定义扩展工作任务
2. 规划底盘移动路径
3. 执行连续作业
4. 验证作业精度

**预期结果**:
- 工作空间有效扩展
- 作业连续性好
- 定位精度保持

### Level 3: 场景测试

#### 3.1 典型任务场景

##### 3.1.1 物体抓取与放置
**测试ID**: SCN-001  
**测试目的**: 验证抓放任务执行能力  
**测试步骤**:
1. 识别目标物体位置
2. 规划抓取路径
3. 执行抓取动作
4. 移动并放置物体

**预期结果**:
- 抓取成功率 > 95%
- 放置精度 < 5mm
- 动作流畅自然

##### 3.1.2 双臂协作装配
**测试ID**: SCN-002  
**测试目的**: 验证双臂装配作业能力  
**测试步骤**:
1. 左臂固定工件
2. 右臂执行装配
3. 协调力控制
4. 完成装配任务

**预期结果**:
- 装配成功率 > 90%
- 力控制稳定
- 无损伤发生

##### 3.1.3 移动式巡检作业
**测试ID**: SCN-003  
**测试目的**: 验证移动巡检能力  
**测试步骤**:
1. 设定巡检路线
2. 移动到检查点
3. 机械臂执行检查
4. 记录检查结果

**预期结果**:
- 路线执行准确
- 检查点定位精确
- 数据记录完整

#### 3.2 异常处理测试

##### 3.2.1 通信中断恢复测试
**测试ID**: EXC-001  
**测试目的**: 验证通信异常处理  
**测试步骤**:
1. 模拟网络中断
2. 验证安全停止
3. 恢复通信连接
4. 继续执行任务

**预期结果**:
- 安全停止及时
- 状态保持完整
- 恢复后正常工作

##### 3.2.2 碰撞检测与响应测试
**测试ID**: EXC-002  
**测试目的**: 验证碰撞保护功能  
**测试步骤**:
1. 设置碰撞阈值
2. 模拟碰撞场景
3. 验证停止响应
4. 测试恢复流程

**预期结果**:
- 碰撞检测灵敏
- 停止响应 < 50ms
- 可安全恢复

##### 3.2.3 极限工况测试
**测试ID**: EXC-003  
**测试目的**: 验证极限条件下的系统表现  
**测试步骤**:
1. 测试最大负载
2. 测试最高速度
3. 测试连续运行
4. 监测系统状态

**预期结果**:
- 负载能力达标
- 速度控制稳定
- 长时运行可靠

#### 3.3 性能测试

##### 3.3.1 响应时间测试
**测试ID**: PERF-001  
**测试目的**: 测量系统响应性能  
**测试内容**:
- 指令响应时间
- 急停响应时间
- 状态更新频率
- 数据传输延迟

**性能指标**:
- 指令响应 < 20ms
- 急停响应 < 50ms
- 状态更新 > 100Hz
- 数据延迟 < 10ms

##### 3.3.2 运动平滑性测试
**测试ID**: PERF-002  
**测试目的**: 评估运动控制质量  
**测试内容**:
- 速度曲线平滑度
- 加速度连续性
- 轨迹跟踪精度
- 振动抑制效果

**性能指标**:
- 速度波动 < 5%
- 加速度跳变 < 10%
- 轨迹误差 < 2mm
- 振动幅度 < 1mm

##### 3.3.3 系统稳定性测试
**测试ID**: PERF-003  
**测试目的**: 验证长时运行稳定性  
**测试内容**:
- 连续运行测试 (24小时)
- 内存泄漏检查
- CPU使用率监测
- 温度监控

**性能指标**:
- 无崩溃发生
- 内存稳定
- CPU < 80%
- 温升 < 10°C

### Level 4: 验收测试

#### 4.1 功能验收清单

| 功能模块 | 测试项 | 验收标准 | 结果 |
|---------|--------|----------|------|
| 单臂控制 | 基础运动功能 | 6轴独立控制正常 | □ |
| 单臂控制 | 笛卡尔运动 | 直线/圆弧精度达标 | □ |
| 双臂协调 | 同步控制 | 双臂协调动作流畅 | □ |
| 双臂协调 | 防碰撞 | 安全距离保持有效 | □ |
| 底盘控制 | 移动导航 | 定位精度 < 10mm | □ |
| 底盘控制 | 避障功能 | 障碍物检测可靠 | □ |
| 系统集成 | 联动控制 | 底盘臂协调正常 | □ |
| 安全功能 | 急停功能 | 响应时间 < 50ms | □ |
| 安全功能 | 碰撞保护 | 力控保护有效 | □ |
| 用户界面 | GUI操作 | 界面响应流畅 | □ |

#### 4.2 性能验收标准

| 性能指标 | 要求值 | 实测值 | 是否达标 |
|---------|--------|--------|----------|
| 重复定位精度 | < 0.1mm | ___ | □ |
| 轨迹精度 | < 2mm | ___ | □ |
| 最大速度 | > 1m/s | ___ | □ |
| 响应时间 | < 20ms | ___ | □ |
| 工作空间 | > 600mm | ___ | □ |
| 负载能力 | > 3kg | ___ | □ |
| 连续运行 | > 24h | ___ | □ |

#### 4.3 安全验收要求

1. **机械安全**
   - □ 紧急停止按钮功能正常
   - □ 软件急停响应及时
   - □ 运动范围限制有效
   - □ 碰撞检测灵敏度合适

2. **电气安全**
   - □ 接地保护完善
   - □ 过流保护正常
   - □ 绝缘电阻合格
   - □ 电磁兼容达标

3. **操作安全**
   - □ 安全区域标识清晰
   - □ 操作规程完整
   - □ 警示标识齐全
   - □ 培训记录完备

## 测试执行指南

### 1. 测试准备

#### 1.1 环境准备
```bash
# 1. 激活虚拟环境
source venv/bin/activate

# 2. 安装测试依赖
pip install pytest pytest-asyncio pytest-timeout

# 3. 检查网络连接
ping 192.168.58.2  # 右臂
ping 192.168.58.3  # 左臂
ping 192.168.31.211  # 底盘

# 4. 启动测试监控
python fr3_hermes_testing/test_monitor.py
```

#### 1.2 安全检查
- [ ] 急停按钮就位
- [ ] 安全区域清空
- [ ] 测试人员到位
- [ ] 监控系统启动

### 2. 测试执行流程

```python
# 测试主程序示例
class RobotTestSuite:
    def __init__(self):
        self.safety_check = SafetyChecker()
        self.data_logger = DataLogger()
        self.remote_control = RemoteController()
        
    def run_test(self, test_id):
        # 1. 安全检查
        if not self.safety_check.is_safe():
            return False
            
        # 2. 初始化日志
        self.data_logger.start(test_id)
        
        # 3. 启用远程监控
        self.remote_control.enable()
        
        # 4. 执行测试
        try:
            result = self.execute_test(test_id)
        except Exception as e:
            self.emergency_stop()
            result = TestResult.FAILED
            
        # 5. 保存结果
        self.data_logger.save()
        
        return result
```

### 3. 数据记录格式

```json
{
  "test_id": "SAT-001",
  "timestamp": "2025-01-15T10:30:00",
  "duration": 120.5,
  "result": "PASSED",
  "data": {
    "joint_positions": [...],
    "tcp_positions": [...],
    "forces": [...],
    "errors": []
  },
  "notes": "测试正常完成"
}
```

### 4. 问题处理流程

1. **发现问题**
   - 记录问题现象
   - 保存当前数据
   - 截图/录像

2. **分析问题**
   - 查看日志文件
   - 分析数据曲线
   - 复现问题

3. **解决问题**
   - 定位问题原因
   - 制定解决方案
   - 实施修复

4. **验证修复**
   - 重新测试
   - 确认问题解决
   - 更新文档

## 测试报告模板

### 测试总结报告

```markdown
# XC-ROBOT 系统测试报告

## 测试概况
- 测试日期: ____年__月__日
- 测试版本: v_____
- 测试人员: _____
- 测试环境: _____

## 测试结果汇总
- 总测试项: ___
- 通过项: ___
- 失败项: ___
- 跳过项: ___
- 通过率: ___%

## 问题清单
1. [问题ID] 问题描述
   - 严重程度: 高/中/低
   - 影响范围: _____
   - 解决状态: 已解决/进行中/待解决

## 性能数据
- 平均响应时间: ___ms
- 定位精度: ___mm
- 连续运行时间: ___小时

## 结论和建议
_____

## 附件
- 详细测试数据
- 问题截图
- 测试视频
```

## GUI测试选项卡建议

### 建议开发GUI测试选项卡

基于测试需求分析，**强烈建议**开发一个专门的GUI测试选项卡，理由如下：

#### 1. 功能需求
- **交互式测试配置**: 可视化设置测试参数、安全阈值、运动范围
- **实时监控面板**: 显示双臂距离、速度、力矩等关键参数
- **测试序列管理**: 创建、编辑、保存测试序列
- **结果可视化**: 实时显示测试曲线、轨迹、错误信息

#### 2. 设计方案

```python
class TestingWidget(QWidget):
    """测试功能选项卡"""
    
    def __init__(self):
        super().__init__()
        self.init_ui()
        
    def init_ui(self):
        # 1. 测试配置区
        self.test_config_group = self.create_test_config()
        
        # 2. 安全监控区  
        self.safety_monitor_group = self.create_safety_monitor()
        
        # 3. 测试控制区
        self.test_control_group = self.create_test_control()
        
        # 4. 数据显示区
        self.data_display_group = self.create_data_display()
        
        # 5. 结果记录区
        self.result_log_group = self.create_result_log()
```

#### 3. 核心功能模块

##### 3.1 测试配置模块
- 测试类型选择（单臂/双臂/底盘/联动）
- 参数设置（速度/加速度/安全距离）
- 测试模式（手动/自动/批量）

##### 3.2 安全监控模块
- 实时距离显示（双臂间距、障碍物距离）
- 力矩监控（关节力矩、末端力）
- 紧急停止按钮（大型红色按钮）
- 状态指示灯（正常/警告/错误）

##### 3.3 测试执行模块
- 开始/暂停/停止按钮
- 进度条显示
- 当前测试步骤
- 远程中断接口

##### 3.4 数据可视化模块
- 实时曲线图（位置/速度/力矩）
- 3D轨迹显示
- 错误分布图
- 性能指标仪表盘

##### 3.5 结果管理模块
- 测试日志列表
- 结果导出（Excel/PDF）
- 截图/录像功能
- 报告生成

#### 4. 实现优先级

| 优先级 | 功能 | 说明 |
|--------|------|------|
| P0 | 紧急停止 | 最高优先级安全功能 |
| P0 | 实时监控 | 双臂距离、速度监控 |
| P1 | 测试配置 | 基础测试参数设置 |
| P1 | 手动测试 | 交互式单步测试 |
| P2 | 自动测试 | 批量测试执行 |
| P2 | 数据记录 | 测试数据保存 |
| P3 | 可视化 | 高级图表显示 |
| P3 | 报告生成 | 自动生成测试报告 |

### 5. 集成建议

```python
# 在 main_window.py 中添加
self.testing_widget = TestingWidget()
self.tab_widget.addTab(self.testing_widget, "测试中心")

# 与现有模块集成
self.testing_widget.arm_controller = self.arm_control_widget.controller
self.testing_widget.chassis_controller = self.chassis_widget.controller
self.testing_widget.safety_system = self.safety_manager
```

## 下一步行动计划

1. **立即执行**
   - [ ] 在 `fr3_hermes_testing/` 创建基础测试脚本
   - [ ] 实现紧急停止和安全监控模块
   - [ ] 开发单臂基础测试程序

2. **短期计划** (1-2周)
   - [ ] 完成Level 1组件级测试脚本
   - [ ] 开发GUI测试选项卡原型
   - [ ] 建立测试数据记录系统

3. **中期计划** (1个月)
   - [ ] 完成Level 2集成测试
   - [ ] 实现完整的GUI测试界面
   - [ ] 开始场景测试

4. **长期计划** (2-3个月)
   - [ ] 完成全部测试用例
   - [ ] 优化测试自动化
   - [ ] 建立持续集成测试

---

**文档版本**: v1.0  
**创建日期**: 2025-01-15  
**维护人**: Claude Code Assistant  
**状态**: 初始版本，待实施验证