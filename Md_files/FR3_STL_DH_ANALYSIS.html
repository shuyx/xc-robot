<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>FR3_STL_DH_ANALYSIS</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="css/markdown.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">FR3_STL_DH_ANALYSIS</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#fr3机械臂stl文件与dh参数深度分析" id="toc-fr3机械臂stl文件与dh参数深度分析"><span class="toc-section-number">1</span> FR3机械臂STL文件与DH参数深度分析</a>
<ul>
<li><a href="#概述" id="toc-概述"><span class="toc-section-number">1.1</span> 概述</a></li>
<li><a href="#stl文件分析与转换" id="toc-stl文件分析与转换"><span class="toc-section-number">1.2</span> 1. STL文件分析与转换</a>
<ul>
<li><a href="#stl文件格式要求" id="toc-stl文件格式要求"><span class="toc-section-number">1.2.1</span> 1.1 STL文件格式要求</a></li>
<li><a href="#从cad软件导出stl" id="toc-从cad软件导出stl"><span class="toc-section-number">1.2.2</span> 1.2 从CAD软件导出STL</a></li>
<li><a href="#stl文件命名与组织" id="toc-stl文件命名与组织"><span class="toc-section-number">1.2.3</span> 1.3 STL文件命名与组织</a></li>
</ul></li>
<li><a href="#dh参数深度分析" id="toc-dh参数深度分析"><span class="toc-section-number">1.3</span> 2. DH参数深度分析</a>
<ul>
<li><a href="#modified-dh-convention说明" id="toc-modified-dh-convention说明"><span class="toc-section-number">1.3.1</span> 2.1 Modified DH Convention说明</a></li>
<li><a href="#fr3精确dh参数表" id="toc-fr3精确dh参数表"><span class="toc-section-number">1.3.2</span> 2.2 FR3精确DH参数表</a></li>
<li><a href="#关键尺寸验证" id="toc-关键尺寸验证"><span class="toc-section-number">1.3.3</span> 2.3 关键尺寸验证</a></li>
<li><a href="#robodk参数对比分析" id="toc-robodk参数对比分析"><span class="toc-section-number">1.3.4</span> 2.4 RoboDK参数对比分析</a></li>
</ul></li>
<li><a href="#运动学模型实现" id="toc-运动学模型实现"><span class="toc-section-number">1.4</span> 3. 运动学模型实现</a>
<ul>
<li><a href="#正向运动学计算" id="toc-正向运动学计算"><span class="toc-section-number">1.4.1</span> 3.1 正向运动学计算</a></li>
<li><a href="#逆向运动学求解" id="toc-逆向运动学求解"><span class="toc-section-number">1.4.2</span> 3.2 逆向运动学求解</a></li>
<li><a href="#奇异性分析" id="toc-奇异性分析"><span class="toc-section-number">1.4.3</span> 3.3 奇异性分析</a></li>
</ul></li>
<li><a href="#stl文件在vtk仿真中的应用" id="toc-stl文件在vtk仿真中的应用"><span class="toc-section-number">1.5</span> 4. STL文件在VTK仿真中的应用</a>
<ul>
<li><a href="#stl加载与显示" id="toc-stl加载与显示"><span class="toc-section-number">1.5.1</span> 4.1 STL加载与显示</a></li>
<li><a href="#关节变换应用" id="toc-关节变换应用"><span class="toc-section-number">1.5.2</span> 4.2 关节变换应用</a></li>
<li><a href="#碰撞检测集成" id="toc-碰撞检测集成"><span class="toc-section-number">1.5.3</span> 4.3 碰撞检测集成</a></li>
</ul></li>
<li><a href="#仿真系统集成方案" id="toc-仿真系统集成方案"><span class="toc-section-number">1.6</span> 5. 仿真系统集成方案</a>
<ul>
<li><a href="#gui集成架构" id="toc-gui集成架构"><span class="toc-section-number">1.6.1</span> 5.1 GUI集成架构</a></li>
<li><a href="#实时仿真更新" id="toc-实时仿真更新"><span class="toc-section-number">1.6.2</span> 5.2 实时仿真更新</a></li>
</ul></li>
<li><a href="#工具脚本与辅助功能" id="toc-工具脚本与辅助功能"><span class="toc-section-number">1.7</span> 6. 工具脚本与辅助功能</a>
<ul>
<li><a href="#stl文件验证工具" id="toc-stl文件验证工具"><span class="toc-section-number">1.7.1</span> 6.1 STL文件验证工具</a></li>
<li><a href="#dh参数测试工具" id="toc-dh参数测试工具"><span class="toc-section-number">1.7.2</span> 6.2 DH参数测试工具</a></li>
</ul></li>
<li><a href="#问题记录与解决方案" id="toc-问题记录与解决方案"><span class="toc-section-number">1.8</span> 7. 问题记录与解决方案</a>
<ul>
<li><a href="#已解决问题" id="toc-已解决问题"><span class="toc-section-number">1.8.1</span> 7.1 已解决问题</a></li>
<li><a href="#待优化项目" id="toc-待优化项目"><span class="toc-section-number">1.8.2</span> 7.2 待优化项目</a></li>
</ul></li>
<li><a href="#开发工作流程" id="toc-开发工作流程"><span class="toc-section-number">1.9</span> 8. 开发工作流程</a>
<ul>
<li><a href="#stl文件更新流程" id="toc-stl文件更新流程"><span class="toc-section-number">1.9.1</span> 8.1 STL文件更新流程</a></li>
<li><a href="#dh参数调优流程" id="toc-dh参数调优流程"><span class="toc-section-number">1.9.2</span> 8.2 DH参数调优流程</a></li>
</ul></li>
<li><a href="#参考资料" id="toc-参考资料"><span class="toc-section-number">1.10</span> 9. 参考资料</a>
<ul>
<li><a href="#技术文档" id="toc-技术文档"><span class="toc-section-number">1.10.1</span> 9.1 技术文档</a></li>
<li><a href="#相关文件" id="toc-相关文件"><span class="toc-section-number">1.10.2</span> 9.2 相关文件</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="fr3机械臂stl文件与dh参数深度分析"><span class="header-section-number">1</span> FR3机械臂STL文件与DH参数深度分析</h1>
<h2 data-number="1.1" id="概述"><span class="header-section-number">1.1</span> 概述</h2>
<p>本文档汇总了FR3机械臂的STL文件处理、DH参数分析和运动学仿真的完整技术方案，基于RoboDK参数对比、实际测量和仿真验证的综合分析结果。</p>
<h2 data-number="1.2" id="stl文件分析与转换"><span class="header-section-number">1.2</span> 1. STL文件分析与转换</h2>
<h3 data-number="1.2.1" id="stl文件格式要求"><span class="header-section-number">1.2.1</span> 1.1 STL文件格式要求</h3>
<p><strong>技术规格</strong>： - <strong>格式</strong>: STL Binary (推荐) 或 STL ASCII - <strong>单位</strong>: 毫米 (mm) - <strong>精度</strong>: 0.1mm - <strong>坐标系</strong>: 右手坐标系，Z轴向上 - <strong>法线</strong>: 确保外法线方向正确</p>
<p><strong>文件大小控制</strong>： - 单个STL文件: ≤ 10MB - 三角面片数: 10K-50K (平衡精度与性能) - 压缩比: Binary格式可减少50%文件大小</p>
<h3 data-number="1.2.2" id="从cad软件导出stl"><span class="header-section-number">1.2.2</span> 1.2 从CAD软件导出STL</h3>
<h4 data-number="1.2.2.1" id="rhino导出设置"><span class="header-section-number">1.2.2.1</span> 1.2.1 Rhino导出设置</h4>
<pre><code>导出参数：
- 文件格式: STL Binary
- 单位: 毫米
- 容差: 0.1mm
- 角度容差: 20度
- 最小边长: 0.01mm
- 最大边长: 0.0 (无限制)
- 纵横比: 0.0 (无限制)</code></pre>
<h4 data-number="1.2.2.2" id="solidworks导出设置"><span class="header-section-number">1.2.2.2</span> 1.2.2 SolidWorks导出设置</h4>
<pre><code>导出参数：
- 格式: STL Binary
- 单位: mm
- 分辨率: 细节(Fine)
- 偏差: 0.1mm
- 角度偏差: 10度
- 合并共面: 是</code></pre>
<h4 data-number="1.2.2.3" id="坐标系对齐要求"><span class="header-section-number">1.2.2.3</span> 1.2.3 坐标系对齐要求</h4>
<ul>
<li><strong>基座原点</strong>: FR3基座底部中心</li>
<li><strong>X轴正方向</strong>: 机械臂前方</li>
<li><strong>Y轴正方向</strong>: 机械臂左侧</li>
<li><strong>Z轴正方向</strong>: 垂直向上</li>
<li><strong>关节轴</strong>: 每个连杆的关节轴应对齐坐标轴</li>
</ul>
<h3 data-number="1.2.3" id="stl文件命名与组织"><span class="header-section-number">1.2.3</span> 1.3 STL文件命名与组织</h3>
<h4 data-number="1.2.3.1" id="标准命名规则"><span class="header-section-number">1.2.3.1</span> 1.3.1 标准命名规则</h4>
<pre><code>FR3机械臂部件命名：
fr3_base.stl      - 固定基座
fr3_link1.stl     - 连杆1 (J1旋转部分)
fr3_link2.stl     - 连杆2 (大臂)
fr3_link3.stl     - 连杆3 (小臂)
fr3_link4.stl     - 连杆4 (腕部1)
fr3_link5.stl     - 连杆5 (腕部2)
fr3_link6.stl     - 连杆6 (腕部3/法兰)
fr3_gripper.stl   - 末端执行器 (可选)</code></pre>
<h4 data-number="1.2.3.2" id="文件目录结构"><span class="header-section-number">1.2.3.2</span> 1.3.2 文件目录结构</h4>
<pre><code>models/
├── stl/                    # STL文件目录
│   ├── fr3_base.stl
│   ├── fr3_link1.stl
│   ├── fr3_link2.stl
│   ├── fr3_link3.stl
│   ├── fr3_link4.stl
│   ├── fr3_link5.stl
│   ├── fr3_link6.stl
│   └── fr3_gripper.stl
├── urdf/                   # URDF描述文件
│   └── fr3_robot.urdf
└── textures/               # 纹理文件 (可选)
    └── fr3_materials.mtl</code></pre>
<h2 data-number="1.3" id="dh参数深度分析"><span class="header-section-number">1.3</span> 2. DH参数深度分析</h2>
<h3 data-number="1.3.1" id="modified-dh-convention说明"><span class="header-section-number">1.3.1</span> 2.1 Modified DH Convention说明</h3>
<p><strong>坐标系建立规则</strong>： 1. Z轴沿关节旋转轴方向 2. X轴垂直于相邻两个Z轴 3. Y轴由右手坐标系确定 4. 原点位于X轴与Z轴的交点</p>
<p><strong>参数定义</strong>： - <strong>α(i-1)</strong>: 连杆扭转角，绕X(i-1)轴旋转 - <strong>a(i-1)</strong>: 连杆长度，沿X(i-1)轴平移 - <strong>d(i)</strong>: 连杆偏移，沿Z(i)轴平移 - <strong>θ(i)</strong>: 关节角，绕Z(i)轴旋转</p>
<h3 data-number="1.3.2" id="fr3精确dh参数表"><span class="header-section-number">1.3.2</span> 2.2 FR3精确DH参数表</h3>
<p>基于官方文档、RoboDK分析和实际测量的综合结果：</p>
<table>
<thead>
<tr>
<th>关节</th>
<th>α(i-1)</th>
<th>a(i-1)</th>
<th>d(i)</th>
<th>θ(i)</th>
<th>关节范围</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>J1</td>
<td>0°</td>
<td>0 mm</td>
<td>333 mm</td>
<td>q1</td>
<td>±170°</td>
<td>基座高度</td>
</tr>
<tr>
<td>J2</td>
<td>-90°</td>
<td>0 mm</td>
<td>0 mm</td>
<td>q2-90°</td>
<td>±120°</td>
<td>肩部关节偏移</td>
</tr>
<tr>
<td>J3</td>
<td>0°</td>
<td>316 mm</td>
<td>0 mm</td>
<td>q3+90°</td>
<td>±170°</td>
<td>大臂长度</td>
</tr>
<tr>
<td>J4</td>
<td>90°</td>
<td>0 mm</td>
<td>384 mm</td>
<td>q4</td>
<td>±170°</td>
<td>小臂长度</td>
</tr>
<tr>
<td>J5</td>
<td>-90°</td>
<td>0 mm</td>
<td>0 mm</td>
<td>q5</td>
<td>±120°</td>
<td>腕部关节</td>
</tr>
<tr>
<td>J6</td>
<td>90°</td>
<td>0 mm</td>
<td>107 mm</td>
<td>q6</td>
<td>±175°</td>
<td>法兰距离</td>
</tr>
</tbody>
</table>
<h3 data-number="1.3.3" id="关键尺寸验证"><span class="header-section-number">1.3.3</span> 2.3 关键尺寸验证</h3>
<p><strong>实测关键尺寸</strong>： - 基座到J2距离: 333mm ✓ - 大臂连杆长度: 316mm ✓ - 小臂连杆长度: 384mm ✓ - 腕部到法兰距离: 107mm ✓ - 总臂展: 约630mm ✓</p>
<p><strong>工作空间范围</strong>： - 最大工作半径: 630mm - 最小工作半径: 约100mm - 垂直工作范围: -200mm 到 +800mm</p>
<h3 data-number="1.3.4" id="robodk参数对比分析"><span class="header-section-number">1.3.4</span> 2.4 RoboDK参数对比分析</h3>
<h4 data-number="1.3.4.1" id="参数差异分析"><span class="header-section-number">1.3.4.1</span> 2.4.1 参数差异分析</h4>
<pre><code>官方DH vs RoboDK vs 实测:

J2关节角度偏移:
- 官方: θ2 = q2
- RoboDK: θ2 = q2 - 90°  ← 采用
- 说明: RoboDK考虑了机械零位偏移

J3关节角度偏移:
- 官方: θ3 = q3  
- RoboDK: θ3 = q3 + 90°  ← 采用
- 说明: 补偿肘部机械结构偏移

连杆长度一致性:
- a2 = 316mm (大臂) ✓
- d4 = 384mm (小臂) ✓
- d6 = 107mm (法兰) ✓</code></pre>
<h4 data-number="1.3.4.2" id="坐标系转换"><span class="header-section-number">1.3.4.2</span> 2.4.2 坐标系转换</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RoboDK到实际机器人的角度转换</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> robodk_to_robot_angles(robodk_angles):</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">    RoboDK角度转换为实际机器人角度</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    robot_angles <span class="op">=</span> robodk_angles.copy()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    robot_angles[<span class="dv">1</span>] <span class="op">+=</span> <span class="dv">90</span>  <span class="co"># J2补偿</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    robot_angles[<span class="dv">2</span>] <span class="op">-=</span> <span class="dv">90</span>  <span class="co"># J3补偿</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> robot_angles</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> robot_to_robodk_angles(robot_angles):</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">    实际机器人角度转换为RoboDK角度</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    robodk_angles <span class="op">=</span> robot_angles.copy()</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    robodk_angles[<span class="dv">1</span>] <span class="op">-=</span> <span class="dv">90</span>  <span class="co"># J2补偿</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    robodk_angles[<span class="dv">2</span>] <span class="op">+=</span> <span class="dv">90</span>  <span class="co"># J3补偿</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> robodk_angles</span></code></pre></div>
<h2 data-number="1.4" id="运动学模型实现"><span class="header-section-number">1.4</span> 3. 运动学模型实现</h2>
<h3 data-number="1.4.1" id="正向运动学计算"><span class="header-section-number">1.4.1</span> 3.1 正向运动学计算</h3>
<p><strong>变换矩阵构建</strong>：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_transform_matrix(alpha, a, d, theta):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    构建Modified DH变换矩阵</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ca, sa <span class="op">=</span> cos(alpha), sin(alpha)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    ct, st <span class="op">=</span> cos(theta), sin(theta)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    T <span class="op">=</span> np.array([</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        [ct,    <span class="op">-</span>st,    <span class="dv">0</span>,      a],</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        [st<span class="op">*</span>ca, ct<span class="op">*</span>ca,  <span class="op">-</span>sa,    <span class="op">-</span>d<span class="op">*</span>sa],</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        [st<span class="op">*</span>sa, ct<span class="op">*</span>sa,  ca,     d<span class="op">*</span>ca],</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">0</span>,     <span class="dv">0</span>,      <span class="dv">0</span>,      <span class="dv">1</span>]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T</span></code></pre></div>
<p><strong>完整正向运动学</strong>：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forward_kinematics(joint_angles):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">    FR3正向运动学求解</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">        joint_angles: [q1, q2, q3, q4, q5, q6] (度)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">        T_06: 4x4变换矩阵 (末端相对基座)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># DH参数 (alpha, a, d, theta_offset)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    dh_params <span class="op">=</span> [</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">0</span>,    <span class="dv">0</span>,   <span class="dv">333</span>, <span class="dv">0</span>),      <span class="co"># J1</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        (<span class="op">-</span><span class="dv">90</span>,  <span class="dv">0</span>,   <span class="dv">0</span>,   <span class="op">-</span><span class="dv">90</span>),    <span class="co"># J2</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">0</span>,    <span class="dv">316</span>, <span class="dv">0</span>,   <span class="dv">90</span>),     <span class="co"># J3</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">90</span>,   <span class="dv">0</span>,   <span class="dv">384</span>, <span class="dv">0</span>),      <span class="co"># J4</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        (<span class="op">-</span><span class="dv">90</span>,  <span class="dv">0</span>,   <span class="dv">0</span>,   <span class="dv">0</span>),      <span class="co"># J5</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">90</span>,   <span class="dv">0</span>,   <span class="dv">107</span>, <span class="dv">0</span>)       <span class="co"># J6</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    T_cumulative <span class="op">=</span> np.eye(<span class="dv">4</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (alpha, a, d, theta_offset) <span class="kw">in</span> <span class="bu">enumerate</span>(dh_params):</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">=</span> joint_angles[i] <span class="op">+</span> theta_offset</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        T_i <span class="op">=</span> build_transform_matrix(</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>            np.radians(alpha), a, d, np.radians(theta)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        T_cumulative <span class="op">=</span> T_cumulative <span class="op">@</span> T_i</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T_cumulative</span></code></pre></div>
<h3 data-number="1.4.2" id="逆向运动学求解"><span class="header-section-number">1.4.2</span> 3.2 逆向运动学求解</h3>
<p><strong>几何法求解策略</strong>： 1. <strong>位置解耦</strong>: 先求腕部中心位置 2. <strong>关节1-3求解</strong>: 解决位置问题<br />
3. <strong>关节4-6求解</strong>: 解决姿态问题</p>
<p><strong>腕部中心计算</strong>：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_wrist_center(target_pose):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    计算腕部中心位置</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    R_06 <span class="op">=</span> target_pose[:<span class="dv">3</span>, :<span class="dv">3</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    p_06 <span class="op">=</span> target_pose[:<span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 腕部中心 = 末端位置 - d6 * Z轴方向</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    d6 <span class="op">=</span> <span class="dv">107</span>  <span class="co"># mm</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    z6 <span class="op">=</span> R_06[:, <span class="dv">2</span>]  <span class="co"># 末端Z轴方向</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    p_wrist <span class="op">=</span> p_06 <span class="op">-</span> d6 <span class="op">*</span> z6</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p_wrist</span></code></pre></div>
<h3 data-number="1.4.3" id="奇异性分析"><span class="header-section-number">1.4.3</span> 3.3 奇异性分析</h3>
<p><strong>奇异配置识别</strong>：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_singularity(joint_angles, threshold<span class="op">=</span><span class="fl">1e-3</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">    检查机械臂奇异性配置</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    singularities <span class="op">=</span> []</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 肩部奇异性 (J1轴与末端重合)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">abs</span>(joint_angles[<span class="dv">0</span>]) <span class="op">&lt;</span> threshold:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        singularities.append(<span class="st">&quot;shoulder&quot;</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 肘部奇异性 (J3 = 0°或180°)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">abs</span>(joint_angles[<span class="dv">2</span>]) <span class="op">&lt;</span> threshold <span class="kw">or</span> <span class="bu">abs</span>(<span class="bu">abs</span>(joint_angles[<span class="dv">2</span>]) <span class="op">-</span> <span class="dv">180</span>) <span class="op">&lt;</span> threshold:</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        singularities.append(<span class="st">&quot;elbow&quot;</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 腕部奇异性 (J5 = 0°)</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">abs</span>(joint_angles[<span class="dv">4</span>]) <span class="op">&lt;</span> threshold:</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        singularities.append(<span class="st">&quot;wrist&quot;</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> singularities</span></code></pre></div>
<h2 data-number="1.5" id="stl文件在vtk仿真中的应用"><span class="header-section-number">1.5</span> 4. STL文件在VTK仿真中的应用</h2>
<h3 data-number="1.5.1" id="stl加载与显示"><span class="header-section-number">1.5.1</span> 4.1 STL加载与显示</h3>
<p><strong>VTK STL读取器配置</strong>：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_stl_model(stl_file_path):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    加载STL文件到VTK</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    reader <span class="op">=</span> vtk.vtkSTLReader()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    reader.SetFileName(stl_file_path)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    reader.Update()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 创建mapper</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    mapper <span class="op">=</span> vtk.vtkPolyDataMapper()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    mapper.SetInputConnection(reader.GetOutputPort())</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 创建actor</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    actor <span class="op">=</span> vtk.vtkActor()</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    actor.SetMapper(mapper)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 设置材质属性</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    actor.GetProperty().SetColor(<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>)  <span class="co"># 浅蓝色</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    actor.GetProperty().SetSpecular(<span class="fl">0.3</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    actor.GetProperty().SetSpecularPower(<span class="dv">30</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> actor</span></code></pre></div>
<h3 data-number="1.5.2" id="关节变换应用"><span class="header-section-number">1.5.2</span> 4.2 关节变换应用</h3>
<p><strong>实时运动学更新</strong>：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_robot_pose(<span class="va">self</span>, joint_angles):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">    根据关节角度更新机器人姿态</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 计算每个连杆的变换矩阵</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    transforms <span class="op">=</span> <span class="va">self</span>.calculate_link_transforms(joint_angles)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 应用变换到VTK actors</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (actor, transform) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(<span class="va">self</span>.link_actors, transforms)):</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        vtk_transform <span class="op">=</span> vtk.vtkTransform()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        vtk_transform.SetMatrix(<span class="va">self</span>.numpy_to_vtk_matrix(transform))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        actor.SetUserTransform(vtk_transform)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 渲染更新</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.render_window.Render()</span></code></pre></div>
<h3 data-number="1.5.3" id="碰撞检测集成"><span class="header-section-number">1.5.3</span> 4.3 碰撞检测集成</h3>
<p><strong>基于STL的碰撞检测</strong>：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_self_collision(<span class="va">self</span>, joint_angles):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">    检查自碰撞</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 更新所有连杆位置</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.update_robot_pose(joint_angles)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 检查相邻连杆之间的距离</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.link_actors) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">2</span>, <span class="bu">len</span>(<span class="va">self</span>.link_actors)):</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>            distance <span class="op">=</span> <span class="va">self</span>.calculate_link_distance(i, j)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> distance <span class="op">&lt;</span> <span class="va">self</span>.collision_threshold:</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span>, <span class="ss">f&quot;Link</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> and Link</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss"> collision&quot;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span>, <span class="st">&quot;&quot;</span></span></code></pre></div>
<h2 data-number="1.6" id="仿真系统集成方案"><span class="header-section-number">1.6</span> 5. 仿真系统集成方案</h2>
<h3 data-number="1.6.1" id="gui集成架构"><span class="header-section-number">1.6.1</span> 5.1 GUI集成架构</h3>
<p><strong>RobotSim控件设计</strong>：</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FR3SimulationWidget(QWidget):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">    FR3机械臂仿真控件</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stl_models <span class="op">=</span> {}  <span class="co"># STL模型缓存</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.kinematics <span class="op">=</span> FR3Kinematics()  <span class="co"># 运动学模型</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.setup_vtk_widget()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.load_robot_models()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_robot_models(<span class="va">self</span>):</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">        加载所有STL模型</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        model_files <span class="op">=</span> [</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fr3_base.stl&quot;</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fr3_link1.stl&quot;</span>, </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fr3_link2.stl&quot;</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fr3_link3.stl&quot;</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fr3_link4.stl&quot;</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fr3_link5.stl&quot;</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fr3_link6.stl&quot;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, filename <span class="kw">in</span> <span class="bu">enumerate</span>(model_files):</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(<span class="st">&quot;models/stl&quot;</span>, filename)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> os.path.exists(file_path):</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>                actor <span class="op">=</span> <span class="va">self</span>.load_stl_model(file_path)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.stl_models[<span class="ss">f&quot;link</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">&quot;</span>] <span class="op">=</span> actor</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.renderer.AddActor(actor)</span></code></pre></div>
<h3 data-number="1.6.2" id="实时仿真更新"><span class="header-section-number">1.6.2</span> 5.2 实时仿真更新</h3>
<p><strong>高频更新机制</strong>：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_real_time_update(<span class="va">self</span>):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">    设置实时更新定时器</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.update_timer <span class="op">=</span> QTimer()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.update_timer.timeout.<span class="ex">connect</span>(<span class="va">self</span>.update_simulation)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.update_timer.start(<span class="dv">50</span>)  <span class="co"># 20Hz更新频率</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_simulation(<span class="va">self</span>):</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">    实时更新仿真显示</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.smooth_motion_enabled:</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 平滑插值到目标位置</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.interpolate_to_target()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 更新运动学计算</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    end_effector_pose <span class="op">=</span> <span class="va">self</span>.kinematics.forward_kinematics(<span class="va">self</span>.current_joint_angles)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 更新3D显示</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.update_robot_pose(<span class="va">self</span>.current_joint_angles)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 更新UI显示</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.update_joint_angle_display()</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.update_end_effector_display(end_effector_pose)</span></code></pre></div>
<h2 data-number="1.7" id="工具脚本与辅助功能"><span class="header-section-number">1.7</span> 6. 工具脚本与辅助功能</h2>
<h3 data-number="1.7.1" id="stl文件验证工具"><span class="header-section-number">1.7.1</span> 6.1 STL文件验证工具</h3>
<p><strong>模型完整性检查</strong>：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> validate_stl_files():</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    验证STL文件完整性</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    required_files <span class="op">=</span> [</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;fr3_base.stl&quot;</span>, <span class="st">&quot;fr3_link1.stl&quot;</span>, <span class="st">&quot;fr3_link2.stl&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;fr3_link3.stl&quot;</span>, <span class="st">&quot;fr3_link4.stl&quot;</span>, <span class="st">&quot;fr3_link5.stl&quot;</span>, <span class="st">&quot;fr3_link6.stl&quot;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> required_files:</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> <span class="ss">f&quot;models/stl/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        results[filename] <span class="op">=</span> {</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;exists&quot;</span>: os.path.exists(file_path),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;size&quot;</span>: os.path.getsize(file_path) <span class="cf">if</span> os.path.exists(file_path) <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;triangles&quot;</span>: count_stl_triangles(file_path) <span class="cf">if</span> os.path.exists(file_path) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span></code></pre></div>
<h3 data-number="1.7.2" id="dh参数测试工具"><span class="header-section-number">1.7.2</span> 6.2 DH参数测试工具</h3>
<p><strong>运动学精度验证</strong>：</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_kinematics_accuracy():</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">    测试运动学计算精度</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    test_cases <span class="op">=</span> [</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>],           <span class="co"># 零位</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">90</span>, <span class="op">-</span><span class="dv">90</span>, <span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">90</span>, <span class="dv">0</span>],      <span class="co"># 典型工作位置</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">0</span>, <span class="op">-</span><span class="dv">30</span>, <span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">0</span>],       <span class="co"># 初始位姿</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        [<span class="op">-</span><span class="dv">90</span>, <span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>, <span class="op">-</span><span class="dv">45</span>, <span class="dv">45</span>, <span class="dv">90</span>]  <span class="co"># 边界测试</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, angles <span class="kw">in</span> <span class="bu">enumerate</span>(test_cases):</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 正向运动学</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        T_forward <span class="op">=</span> forward_kinematics(angles)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 逆向运动学</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        solved_angles <span class="op">=</span> inverse_kinematics(T_forward)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 精度验证</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        error <span class="op">=</span> np.linalg.norm(np.array(angles) <span class="op">-</span> np.array(solved_angles))</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Test case </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: Error = </span><span class="sc">{</span>error<span class="sc">:.6f}</span><span class="ss"> degrees&quot;</span>)</span></code></pre></div>
<h2 data-number="1.8" id="问题记录与解决方案"><span class="header-section-number">1.8</span> 7. 问题记录与解决方案</h2>
<h3 data-number="1.8.1" id="已解决问题"><span class="header-section-number">1.8.1</span> 7.1 已解决问题</h3>
<p><strong>STL文件相关</strong>： - ✅ 坐标系不一致 → 建立标准导出规范 - ✅ 文件过大影响性能 → 控制面片数量和文件大小 - ✅ 法线方向错误 → 确保外法线正确</p>
<p><strong>DH参数相关</strong>： - ✅ 关节偏移理解错误 → 基于RoboDK分析修正 - ✅ 零位定义不清 → 明确机械零位与软件零位 - ✅ 工作空间边界 → 基于实测数据验证</p>
<p><strong>仿真集成相关</strong>： - ✅ VTK加载STL性能问题 → 优化加载和缓存机制 - ✅ 实时更新卡顿 → 降低更新频率和优化算法 - ✅ 内存泄漏 → 正确释放VTK资源</p>
<h3 data-number="1.8.2" id="待优化项目"><span class="header-section-number">1.8.2</span> 7.2 待优化项目</h3>
<p><strong>技术改进</strong>： - [ ] 实现GPU加速的碰撞检测 - [ ] 支持纹理和材质的高质量渲染 - [ ] 添加物理引擎集成 - [ ] 实现关节动力学模拟</p>
<p><strong>用户体验</strong>： - [ ] 添加STL文件批量导入功能 - [ ] 实现参数配置的可视化编辑 - [ ] 支持自定义DH参数表 - [ ] 添加仿真录制和回放功能</p>
<h2 data-number="1.9" id="开发工作流程"><span class="header-section-number">1.9</span> 8. 开发工作流程</h2>
<h3 data-number="1.9.1" id="stl文件更新流程"><span class="header-section-number">1.9.1</span> 8.1 STL文件更新流程</h3>
<ol type="1">
<li><strong>CAD建模</strong> → 在Rhino/SolidWorks中创建或修改模型</li>
<li><strong>导出STL</strong> → 按照规范导出STL文件</li>
<li><strong>文件验证</strong> → 运行验证脚本检查文件完整性</li>
<li><strong>仿真测试</strong> → 在RobotSim中加载测试</li>
<li><strong>性能检查</strong> → 确认渲染性能满足要求</li>
<li><strong>提交更新</strong> → 更新到版本控制系统</li>
</ol>
<h3 data-number="1.9.2" id="dh参数调优流程"><span class="header-section-number">1.9.2</span> 8.2 DH参数调优流程</h3>
<ol type="1">
<li><strong>理论分析</strong> → 基于机械图纸建立初始参数</li>
<li><strong>实测验证</strong> → 使用实际机器人验证参数</li>
<li><strong>仿真对比</strong> → 在仿真中验证运动一致性</li>
<li><strong>精度测试</strong> → 运行自动化精度测试</li>
<li><strong>边界测试</strong> → 验证工作空间边界</li>
<li><strong>参数固化</strong> → 更新到运动学模型</li>
</ol>
<h2 data-number="1.10" id="参考资料"><span class="header-section-number">1.10</span> 9. 参考资料</h2>
<h3 data-number="1.10.1" id="技术文档"><span class="header-section-number">1.10.1</span> 9.1 技术文档</h3>
<ul>
<li>FR3用户手册 - 法奥意威官方文档</li>
<li>Modified DH Convention - Craig机器人学教材</li>
<li>VTK User Guide - VTK官方文档</li>
<li>STL格式规范 - 3D Systems技术文档</li>
</ul>
<h3 data-number="1.10.2" id="相关文件"><span class="header-section-number">1.10.2</span> 9.2 相关文件</h3>
<ul>
<li><code>gui/widgets/fr3_kinematics.py</code> - 运动学模型实现</li>
<li><code>models/fr3_robot.urdf</code> - URDF机器人描述</li>
<li><code>STL_NAMING_GUIDE.md</code> - STL文件命名规范</li>
<li><code>PROJECT_TECHNICAL_OVERVIEW.md</code> - 项目技术全览</li>
</ul>
<hr />
<p><strong>文档版本</strong>: v1.0<br />
<strong>最后更新</strong>: 2025-07-08<br />
<strong>维护人</strong>: Claude Code Assistant<br />
<strong>状态</strong>: 技术方案完整，待实施验证</p>
</body>
</html>
